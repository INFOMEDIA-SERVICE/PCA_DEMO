<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Parque Caribe Aventura Plataforma Administrativa</title>
        <!--JQUERY-->
        <!--<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>-->
        <!-- Bootstrap core JavaScript -->
        <!--<script src="lib/jquery-3.6.0.min.js"></script>-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>       
        <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.flash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.print.min.js"></script>
        
        <!-- Bootstrap -->
        <link href="css/bootstrap-4.4.1.css" rel="stylesheet">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/bootstrap-4.4.1.js"></script>       

        <!-- Include datatables -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">  
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
        
        <style>
            body{
                background-color:white;
            }
            h3.header_h3 {
                text-align: center;
            }
            .boton{
                font-size:10px;
                font-family:Verdana,Helvetica;
                font-weight:bold;
                color:white;
                background:#638cb5;
                border:0px;
                width:80px;
                height:19px;
            }
        </style>
    </head>
    <body>
        <!-- body code goes here -->
        <section class="showcase">
            <div class="container">
                <div>
                    <button type="button" id="abrirModalAtraccion" class="btn btn-primary float-right">Adicionar</button>
                </div>
                <div class="row padall">
                    <div class="col-lg-12" style="padding-bottom:10px; padding-top:10px;">
                        <!--<h3 class="header_h3">Exportar a Excel, CSV, PDF, Print Datatables</h3>-->
                    </div>
                </div>
                <div class="row padall border-bottom">
                    <div class="col-lg-12">
                        <div class="table-responsive-sm">
                            <table id="tbl_atracciones" class="table table-bordered table-striped table-hover dataTable">
                                <thead>
                                    <tr><th>Id</th>
                                        <th>Nombre</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id='cargar_tbody'>

                                </tbody>        
                            </table>
                        </div>
                    </div>
                </div>                 
            </div>
        </section>
        <div class="modal" id="addModalAtraccion" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title">Adicionar atracciones</h1>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">                        
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">Nombre de la atracci&oacute;n</label>
                            <input type="text" class="form-control" id="txtAddAtraccion" aria-describedby="emailHelp">                            
                        </div>
                        <div class="mb-3">
                            <label for="exampleInputPassword1" class="form-label">Imagen 64 bit</label>
                            <input type="text" class="form-control" id="txtAdd64bit">
                        </div>
                    </div>
                    <div class="modal-footer">
                    <button type="button" id="btnGuardarAtraccion"class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Salir</button>
                    </div>
                </div>
            </div>
        </div>              
   
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
        <!--<script src="../js/jquery-3.4.1.min.js"></script>-->

        
        
        

        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <!--<script src="js/popper.min.js"></script>-->
         


        <script>
            $(document).ready( function () { 
                localStorage.clear();               
                var retornar                
                cargarToken();
                //
                cargarDatos();
                //llenar();
            });

            /*function llenar()
            {
                $('#table_id').DataTable({
                    "destroy": true,
                    "data": response,
                    "columns":[
                        {"data":"nombre"},
                        {"data":"codigo"}
                    ]
                });
            }*/

            function cargarToken(){
                var settings = {
                    "url": "http://20.44.111.223:80/api/auth/token",
                    "method": "POST",
                    "async": false,
                    "timeout": 0,
                    "headers": {
                    "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                    "password": "$Info.2021",
                    "username": "infomedia"
                    }),
                };

                $.ajax(settings).done(function (response) {
                    localStorage.setItem('accessToken',response['accessToken']['token'])                  
                    //retornar = response['accessToken']['token'];                                      
                });                  
                //return retornar;             
            }

            function cargarDatos(){
                var toke = localStorage.getItem('accessToken');
                console.log('cargo2');
                if(toke != ""){
                    var settings3 = {
                        "url": "http://20.44.111.223:80/api/boleteria/atracciones",
                        //"url": "http://20.44.111.223:80/api/boleteria/tiposBoleta?incluirImagen=true",
                        "method": "GET",
                        "async": false,
                        "timeout": 0,
                        "headers": {
                            "Authorization": "Bearer "+localStorage.getItem('accessToken')
                        },
                    };
                    $.ajax(settings3).done(function (response) {
                        console.log(response);
                        var str_remp;

                        response.forEach(function(atracciones, index) {
                            console.log(atracciones);
                            var boton = '<button id="edit-category" class="btn btn-sm btn-block btn-primary" type="button" title="Editar" class="boton"><i class="fa fa-fw fa-pencil"></i></button>';
                            str_remp=str_remp+'<tr><td>'+ atracciones.id +'</td><td>'+ atracciones.nombre +'</td><td>'+ boton +'</td></tr>';
                        }); 
                        str_remp=str_remp+'</tbody>';              
                        $("#cargar_tbody").html(str_remp);
                        $('#tbl_atracciones').DataTable({
                            rowReorder: {
                                //selector: 'td:nth-child(2)'
                            },
                            responsive: true,
                            "language": {
                                "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
                            },
                            "bAutoWidth": true,
                            "paging": true,
                            "processing": true,
                            'serverMethod': 'post',
                            //"ajax": "http://20.44.111.223:80/api/boleteria/atracciones",
                            dom: 'lBfrtip',
                            buttons: [
                            'excel', 'csv', 'pdf', 'print', 'copy',
                            ],
                            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
                        });
                    });
                }
            }
            //Fin cargar datos al datatable
            //
            $('#abrirModalAtraccion').click(function(){
                //var tok = localStorage.getItem('accessToken');
                //console.log('TOK: '+tok);
                //console.log('click');
                //CargarPrueba();
                $('#addModalAtraccion').modal('show'); // abrir
                /*var i=document.getElementById("a");
                var temp = i.innerHTML;

                if(temp=="Hola"){
                    i.innerHTML = "Mundo";
                }else{
                    i.innerHTML = "Hola";
                };*/
                
            });
            //
            $('#btnGuardarAtraccion').click(function(){
                var nombre = $("#txtAddAtraccion").val();
                var imagen = $("#txtAdd64bit").val();
                console.log('click GUARDAR '+nombre+' - '+imagen );
                if(nombre != '' && imagen != ''){                        
                    //var token_add = cargarToken();
                    //console.log('Token add '+token_add);
                    adicionarAtracciones(nombre, imagen);
                }else{
                    alert('Llene todos los campos');
                }
                
            });
            //
            function adicionarAtracciones(nombre, imagen){                    
                var token = localStorage.getItem('accessToken');
                if(token != null){
                    var atraccion_post = {
                        "url": "http://20.44.111.223:80/api/boleteria/atraccion",
                        "method": "POST",
                        "async": false,
                        "timeout": 0,
                        "headers": {
                            "Authorization": "Bearer "+token,
                            "Content-Type": "application/json"
                        },
                        "data": JSON.stringify({
                        "estado": "ACTIVO",
                        "imagenBase64": imagen,
                        "nombre": nombre
                        }) 
                        /*{
                        "condicionesAcceso": [
                            0
                        ],
                        "imagenBase64": "string",
                        "nombre": "string"
                        }*/                     
                    };
                    //                        
                    $.ajax(atraccion_post).done(function (response) {
                        console.log(response);
                    });
                    /*fetch('http://20.44.111.223:80/api/boleteria/atraccion', {
                                method: 'POST',
                                body: JSON.stringify({
                                    name: "Taylor",
                                    surname: "Swift"
                                }),
                                headers: {
                                    "Content-type": "application/json"
                                })
                        .then(response => response.json())
                        .then(json => console.log(json))
                        /*fetch('http://20.44.111.223:80/api/boleteria/atraccion')
                            .then(response => response.json())
                            .then(json => console.log(json));*/
                }else{
                    alert('Acceso denegado para guardar');
                }
            }
            //
            //
        </script>    
    </body>
</html>